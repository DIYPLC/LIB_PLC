<?xml version="1.0" encoding="utf-8"?>
<project xmlns="http://www.plcopen.org/xml/tc6_0200">
  <fileHeader companyName="" productName="CODESYS" productVersion="CODESYS V3.5 SP19" creationDateTime="2026-01-26T16:58:28.1301043" />
  <contentHeader name="PLC_ODOT.project" modificationDateTime="2026-01-26T16:51:59.9229809">
    <coordinateInfo>
      <fbd>
        <scaling x="1" y="1" />
      </fbd>
      <ld>
        <scaling x="1" y="1" />
      </ld>
      <sfc>
        <scaling x="1" y="1" />
      </sfc>
    </coordinateInfo>
    <addData>
      <data name="http://www.3s-software.com/plcopenxml/projectinformation" handleUnknown="implementation">
        <ProjectInformation />
      </data>
    </addData>
  </contentHeader>
  <types>
    <dataTypes />
    <pous>
      <pou name="FbScale" pouType="functionBlock">
        <interface>
          <inputVars>
            <variable name="In">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">Вход до масштабирования.</xhtml>
              </documentation>
            </variable>
            <variable name="InMax">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="27648" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">Максимум входного диапазона.</xhtml>
              </documentation>
            </variable>
            <variable name="InMin">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">Минимум входного диапазона.</xhtml>
              </documentation>
            </variable>
            <variable name="OutMax">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="20" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">Максимум выходного диапазона.</xhtml>
              </documentation>
            </variable>
            <variable name="OutMin">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="4" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">Минимум выходного диапазона.</xhtml>
              </documentation>
            </variable>
          </inputVars>
          <outputVars>
            <variable name="Out">
              <type>
                <REAL />
              </type>
              <initialValue>
                <simpleValue value="0" />
              </initialValue>
              <documentation>
                <xhtml xmlns="http://www.w3.org/1999/xhtml">Выход после масштабирования.</xhtml>
              </documentation>
            </variable>
          </outputVars>
        </interface>
        <body>
          <ST>
            <xhtml xmlns="http://www.w3.org/1999/xhtml">//       DbScale
//    +-----------+
//    |  FbScale  |
// -&gt;-|In      Out|-&gt;-
//   -|InMax      |
//   -|InMin      |
//   -|OutMax     |
//   -|OutMin     |
//    +-----------+

//Масштабирование сигнала.
IF (InMax = InMin) THEN //Деление на 0 может остановить процессор.
//При ошибке исходных данных.
Out := 0.0;
ELSE
//Масштабирование.
Out := (OutMax - OutMin) * ((In - InMin)/(InMax - InMin)) + OutMin;
END_IF;


// Статическая характеристика.
//
//       ^ Out
//       |
// OutMax|&lt;---------------*
//       |              * |
//       |            *   |
//    Out|&lt;---------*     |
//       |        * |     |
//       |      *   |     |
// OutMin|&lt;---*     |     |
//       |    |     |     |
//       |    |     |     |
//       +---------------------&gt; In
//          InMin  In   InMax

// Выход сигнал
// Out = k * In + b
//
// Для расчета k, b надо решить систему двух линейных уравнений с двумя неизвестными.
// {OutMax = k * InMax + b
// {OutMin = k * InMin + b
//
// Усиление:
//      OutMax - OutMin 
// k = -----------------
//       InMax - InMin  
//
// Смещение:
// b = OutMax - k * InMax
//
// После подстановки в уравнение Out = k * In + b констант k, b,
// и сокращения числа арифметических операций до минимума получаем:
// Out := (OutMax - OutMin) * ((In - InMin)/(InMax - InMin)) + OutMin;

// Данное линейное преобразование на практике легко вывести через промежуточный диаппазон 0...1:
// InMin...InMax -&gt; 0...(InMax-InMin) -&gt; 0...1 -&gt; 0...(OutMax-OutMin) -&gt; OutMin...OutMax.
// Пример рассчета давления с датчика  4...20мА -&gt; 0...10Бар.
// 4...20 -  4 = 0...16
// 0...16 / 16 = 0...1
// 0...1  * 10 = 0...10
// При токе 12мА
// 12  -   4 = 8
// 8   /  16 = 0.5
// 0.5 *  10 = 5Бар
// Давление 5Бар.

//  +---------+
//  | GNU GPL |
//  +---------+
//  |
//  |
//  .= .-_-. =.
// ((_/)o o(\_))
//  `-'(. .)`-'
//  |/| \_/ |\
//  ( |     | )
//  /"\_____/"\
//  \__)   (__/
// @COPYLEFT ALL WRONGS RESERVED :)
// Author: VA
// Contacts: DIY.PLC.314@gmail.com
// License: GNU GPL v2
//
// https://www.youtube.com/@DIY_PLC
// https://github.com/DIYPLC
</xhtml>
          </ST>
        </body>
        <addData>
          <data name="http://www.3s-software.com/plcopenxml/objectid" handleUnknown="discard">
            <ObjectId>20c362b0-0b15-4e81-8068-006a886bdd4d</ObjectId>
          </data>
        </addData>
      </pou>
    </pous>
  </types>
  <instances>
    <configurations />
  </instances>
  <addData>
    <data name="http://www.3s-software.com/plcopenxml/projectstructure" handleUnknown="discard">
      <ProjectStructure>
        <Folder Name="LIB_PLC">
          <Object Name="FbScale" ObjectId="20c362b0-0b15-4e81-8068-006a886bdd4d" />
        </Folder>
      </ProjectStructure>
    </data>
  </addData>
</project>